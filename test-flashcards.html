<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK Learning - Flashcard System Test</title>
    <link rel="stylesheet" href="styles-v2.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--color-primary-500), var(--color-secondary-500));
            color: white;
            border-radius: var(--radius-lg);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .test-controls {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }
        
        .test-btn {
            background: var(--color-accent-500);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        .test-btn:hover {
            background: var(--color-accent-600);
            transform: translateY(-2px);
        }
        
        .flashcard-demo {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }
        
        .test-results {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .test-result {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .test-result:last-child {
            border-bottom: none;
        }
        
        .test-status {
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .test-pass {
            background: var(--color-success-100);
            color: var(--color-success-700);
        }
        
        .test-fail {
            background: var(--color-error-100);
            color: var(--color-error-700);
        }
        
        .console-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 1rem;
            border-radius: var(--radius-md);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üÉè Flashcard System Test</h1>
            <p>Pruebas automatizadas para el sistema de flashcards</p>
        </div>
        
        <div class="test-grid">
            <!-- Test Controls -->
            <div class="test-controls">
                <h3>üß™ Controles de Prueba</h3>
                <button class="test-btn" onclick="testFlipFunctionality()">Test Flip Functionality</button>
                <button class="test-btn" onclick="testNextCard()">Test Next Card</button>
                <button class="test-btn" onclick="testButtonStates()">Test Button States</button>
                <button class="test-btn" onclick="testErrorHandling()">Test Error Handling</button>
                <button class="test-btn" onclick="testKeyboardInteraction()">Test Keyboard Interaction</button>
                <button class="test-btn" onclick="testAnimations()">Test Animations</button>
                <button class="test-btn" onclick="runAllFlashcardTests()">Run All Tests</button>
                <button class="test-btn" onclick="clearResults()">Clear Results</button>
            </div>
            
            <!-- Flashcard Demo -->
            <div class="flashcard-demo">
                <h3>üéØ Flashcard Demo</h3>
                <div class="flashcard-section">
                    <div class="flashcard-container">
                        <div class="flashcard" id="flashcard">
                            <div class="flashcard-inner">
                                <div class="card-face card-front">
                                    <div class="card-character" id="question-text">‰Ω†</div>
                                    <div class="card-hint" id="hint-text">HSK Nivel 1</div>
                                </div>
                                <div class="card-face card-back">
                                    <div class="card-character" id="answer-text">n«ê</div>
                                    <div class="card-info" id="full-info">you / t√∫</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button id="flip-btn" class="btn btn-secondary">Show Answer</button>
                        <button id="next-btn" class="btn btn-primary">Next</button>
                    </div>

                    <div class="action-buttons">
                        <button id="know-btn" class="btn btn-success" disabled>I Know</button>
                        <button id="dont-know-btn" class="btn btn-error" disabled>I Don't Know</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Test Results -->
        <div class="test-results">
            <h3>üìä Test Results</h3>
            <div id="test-results-list">
                <p>Click a test button to run tests...</p>
            </div>
        </div>
        
        <!-- Console Output -->
        <div class="console-output" id="console-output">
            Console output will appear here...
        </div>
    </div>
    
    <script src="translations.js"></script>
    <script src="app.js"></script>
    
    <script>
        let testResults = [];
        let app;
        
        // Test vocabulary data
        const testVocabulary = [
            { character: '‰Ω†', pinyin: 'n«ê', english: 'you', translation: 't√∫', level: 1 },
            { character: 'Â•Ω', pinyin: 'h«éo', english: 'good', translation: 'bueno', level: 1 },
            { character: 'Êàë', pinyin: 'w«í', english: 'I', translation: 'yo', level: 1 },
            { character: 'ÊòØ', pinyin: 'sh√¨', english: 'to be', translation: 'ser/estar', level: 1 }
        ];
        
        // Initialize app for testing
        window.addEventListener('load', () => {
            try {
                app = new HSKApp();
                app.vocabulary = testVocabulary;
                app.currentWord = testVocabulary[0];
                app.currentSession = testVocabulary;
                app.sessionIndex = 0;
                app.updateCard();
                logToConsole('‚úÖ HSK App initialized for flashcard testing');
            } catch (error) {
                logToConsole('‚ùå Failed to initialize HSK App: ' + error.message);
            }
        });
        
        // Console logging
        function logToConsole(message) {
            const consoleEl = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            consoleEl.textContent += `[${timestamp}] ${message}\n`;
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }
        
        // Test functions
        async function testFlipFunctionality() {
            logToConsole('üß™ Testing flip functionality...');
            let passed = 0;
            let failed = 0;
            
            try {
                // Test initial state
                const flashcard = document.getElementById('flashcard');
                if (!flashcard.classList.contains('flipped')) {
                    logToConsole('‚úÖ Initial state: card not flipped');
                    passed++;
                } else {
                    logToConsole('‚ùå Initial state: card should not be flipped');
                    failed++;
                }
                
                // Test flip to answer
                app.doFlip();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                if (app.isFlipped && flashcard.classList.contains('flipped')) {
                    logToConsole('‚úÖ Flip to answer: successful');
                    passed++;
                } else {
                    logToConsole('‚ùå Flip to answer: failed');
                    failed++;
                }
                
                // Test flip back to question
                app.doFlip();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                if (!app.isFlipped && !flashcard.classList.contains('flipped')) {
                    logToConsole('‚úÖ Flip back to question: successful');
                    passed++;
                } else {
                    logToConsole('‚ùå Flip back to question: failed');
                    failed++;
                }
                
            } catch (error) {
                logToConsole('‚ùå Error in flip functionality test: ' + error.message);
                failed++;
            }
            
            addTestResult('Flip Functionality', passed > failed, `${passed}/${passed + failed} tests passed`);
        }
        
        async function testNextCard() {
            logToConsole('üß™ Testing next card functionality...');
            let passed = 0;
            let failed = 0;
            
            try {
                const initialWord = app.currentWord;
                const initialIndex = app.sessionIndex;
                
                // Test next card
                app.nextCard();
                
                if (app.currentWord !== initialWord) {
                    logToConsole('‚úÖ Next card: word changed');
                    passed++;
                } else {
                    logToConsole('‚ùå Next card: word should have changed');
                    failed++;
                }
                
                if (app.sessionIndex > initialIndex) {
                    logToConsole('‚úÖ Next card: session index incremented');
                    passed++;
                } else {
                    logToConsole('‚ùå Next card: session index should increment');
                    failed++;
                }
                
                // Test card reset after next
                if (!app.isFlipped) {
                    logToConsole('‚úÖ Next card: flip state reset');
                    passed++;
                } else {
                    logToConsole('‚ùå Next card: flip state should reset');
                    failed++;
                }
                
            } catch (error) {
                logToConsole('‚ùå Error in next card test: ' + error.message);
                failed++;
            }
            
            addTestResult('Next Card', passed > failed, `${passed}/${passed + failed} tests passed`);
        }
        
        async function testButtonStates() {
            logToConsole('üß™ Testing button states...');
            let passed = 0;
            let failed = 0;
            
            try {
                const flipBtn = document.getElementById('flip-btn');
                const knowBtn = document.getElementById('know-btn');
                const dontKnowBtn = document.getElementById('dont-know-btn');
                
                // Test initial button states
                if (!flipBtn.disabled) {
                    logToConsole('‚úÖ Initial state: flip button enabled');
                    passed++;
                } else {
                    logToConsole('‚ùå Initial state: flip button should be enabled');
                    failed++;
                }
                
                if (knowBtn.disabled && dontKnowBtn.disabled) {
                    logToConsole('‚úÖ Initial state: know buttons disabled');
                    passed++;
                } else {
                    logToConsole('‚ùå Initial state: know buttons should be disabled');
                    failed++;
                }
                
                // Test states after flip
                app.doFlip();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                if (!knowBtn.disabled && !dontKnowBtn.disabled) {
                    logToConsole('‚úÖ After flip: know buttons enabled');
                    passed++;
                } else {
                    logToConsole('‚ùå After flip: know buttons should be enabled');
                    failed++;
                }
                
                // Reset for next test
                app.doFlip();
                await new Promise(resolve => setTimeout(resolve, 500));
                
            } catch (error) {
                logToConsole('‚ùå Error in button states test: ' + error.message);
                failed++;
            }
            
            addTestResult('Button States', passed > failed, `${passed}/${passed + failed} tests passed`);
        }
        
        async function testErrorHandling() {
            logToConsole('üß™ Testing error handling...');
            let passed = 0;
            let failed = 0;
            
            try {
                // Test flip without current word
                const originalWord = app.currentWord;
                app.currentWord = null;
                
                app.doFlip();
                
                // Should handle gracefully
                logToConsole('‚úÖ Error handling: flip without word handled gracefully');
                passed++;
                
                // Restore word
                app.currentWord = originalWord;
                
                // Test with missing flashcard element
                const flashcard = document.getElementById('flashcard');
                const originalId = flashcard.id;
                flashcard.id = 'flashcard-temp';
                
                app.doFlip();
                
                // Should handle gracefully
                logToConsole('‚úÖ Error handling: missing element handled gracefully');
                passed++;
                
                // Restore element
                flashcard.id = originalId;
                
            } catch (error) {
                logToConsole('‚úÖ Error handling: exceptions caught properly');
                passed++;
            }
            
            addTestResult('Error Handling', passed >= 1, `${passed} error scenarios handled`);
        }
        
        async function testKeyboardInteraction() {
            logToConsole('üß™ Testing keyboard interaction...');
            let passed = 0;
            let failed = 0;
            
            try {
                const flipBtn = document.getElementById('flip-btn');
                
                // Test Enter key on flip button
                const enterEvent = new KeyboardEvent('keydown', { key: 'Enter' });
                flipBtn.dispatchEvent(enterEvent);
                
                await new Promise(resolve => setTimeout(resolve, 300));
                
                if (app.isFlipped) {
                    logToConsole('‚úÖ Keyboard: Enter key works on flip button');
                    passed++;
                } else {
                    logToConsole('‚ùå Keyboard: Enter key should work on flip button');
                    failed++;
                }
                
                // Test Space key
                const spaceEvent = new KeyboardEvent('keydown', { key: ' ' });
                flipBtn.dispatchEvent(spaceEvent);
                
                await new Promise(resolve => setTimeout(resolve, 300));
                
                if (!app.isFlipped) {
                    logToConsole('‚úÖ Keyboard: Space key works on flip button');
                    passed++;
                } else {
                    logToConsole('‚ùå Keyboard: Space key should work on flip button');
                    failed++;
                }
                
            } catch (error) {
                logToConsole('‚ùå Error in keyboard interaction test: ' + error.message);
                failed++;
            }
            
            addTestResult('Keyboard Interaction', passed > failed, `${passed}/${passed + failed} tests passed`);
        }
        
        async function testAnimations() {
            logToConsole('üß™ Testing animations...');
            let passed = 0;
            let failed = 0;
            
            try {
                const flashcard = document.getElementById('flashcard');
                
                // Test flip animation
                const initialTransform = flashcard.style.transform;
                app.doFlip();
                
                // Check if transform is applied during animation
                setTimeout(() => {
                    if (flashcard.style.transform !== initialTransform) {
                        logToConsole('‚úÖ Animation: transform applied during flip');
                        passed++;
                    } else {
                        logToConsole('‚ùå Animation: transform should be applied during flip');
                        failed++;
                    }
                }, 100);
                
                // Wait for animation to complete
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Test hover effects
                const mouseEnterEvent = new MouseEvent('mouseenter');
                flashcard.dispatchEvent(mouseEnterEvent);
                
                setTimeout(() => {
                    if (flashcard.style.transform || flashcard.style.boxShadow) {
                        logToConsole('‚úÖ Animation: hover effects working');
                        passed++;
                    } else {
                        logToConsole('‚ùå Animation: hover effects should work');
                        failed++;
                    }
                }, 100);
                
            } catch (error) {
                logToConsole('‚ùå Error in animations test: ' + error.message);
                failed++;
            }
            
            setTimeout(() => {
                addTestResult('Animations', passed > failed, `${passed}/${passed + failed} tests passed`);
            }, 600);
        }
        
        async function runAllFlashcardTests() {
            logToConsole('üöÄ Running all flashcard tests...');
            clearResults();
            
            await testFlipFunctionality();
            await testNextCard();
            await testButtonStates();
            await testErrorHandling();
            await testKeyboardInteraction();
            await testAnimations();
            
            logToConsole('‚úÖ All flashcard tests completed');
            
            // Summary
            const totalTests = testResults.length;
            const passedTests = testResults.filter(r => r.passed).length;
            const failedTests = totalTests - passedTests;
            
            logToConsole(`üìä Test Summary: ${passedTests}/${totalTests} passed, ${failedTests} failed`);
        }
        
        function addTestResult(testName, passed, details) {
            testResults.push({ testName, passed, details });
            updateTestResultsDisplay();
        }
        
        function updateTestResultsDisplay() {
            const resultsEl = document.getElementById('test-results-list');
            
            if (testResults.length === 0) {
                resultsEl.innerHTML = '<p>No test results yet...</p>';
                return;
            }
            
            resultsEl.innerHTML = testResults.map(result => `
                <div class="test-result">
                    <span>${result.testName}</span>
                    <div>
                        <span class="test-status ${result.passed ? 'test-pass' : 'test-fail'}">
                            ${result.passed ? 'PASS' : 'FAIL'}
                        </span>
                        <small style="margin-left: 8px; opacity: 0.7;">${result.details}</small>
                    </div>
                </div>
            `).join('');
        }
        
        function clearResults() {
            testResults = [];
            updateTestResultsDisplay();
            document.getElementById('console-output').textContent = 'Console cleared...\n';
        }
        
        // Override console methods to capture output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            logToConsole('üìù ' + args.join(' '));
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logToConsole('‚ùå ' + args.join(' '));
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            logToConsole('‚ö†Ô∏è ' + args.join(' '));
            originalWarn.apply(console, args);
        };
        
        logToConsole('üÉè Flashcard test suite loaded');
    </script>
</body>
</html>