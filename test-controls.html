<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK Learning - Interactive Controls Test</title>
    <link rel="stylesheet" href="styles-v2.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--color-primary-500), var(--color-secondary-500));
            color: white;
            border-radius: var(--radius-lg);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .test-section {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }
        
        .test-btn {
            background: var(--color-accent-500);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        .test-btn:hover {
            background: var(--color-accent-600);
            transform: translateY(-2px);
        }
        
        .controls-demo {
            display: grid;
            gap: 1rem;
        }
        
        .control-group {
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
        }
        
        .test-results {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .test-result {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .test-result:last-child {
            border-bottom: none;
        }
        
        .test-status {
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .test-pass {
            background: var(--color-success-100);
            color: var(--color-success-700);
        }
        
        .test-fail {
            background: var(--color-error-100);
            color: var(--color-error-700);
        }
        
        .console-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 1rem;
            border-radius: var(--radius-md);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üéõÔ∏è Interactive Controls Test</h1>
            <p>Pruebas automatizadas para controles interactivos y selectores</p>
        </div>
        
        <div class="test-grid">
            <!-- Test Controls -->
            <div class="test-section">
                <h3>üß™ Controles de Prueba</h3>
                <button class="test-btn" onclick="testLevelSelector()">Test Level Selector</button>
                <button class="test-btn" onclick="testPracticeModes()">Test Practice Modes</button>
                <button class="test-btn" onclick="testThemeToggle()">Test Theme Toggle</button>
                <button class="test-btn" onclick="testLanguageSelector()">Test Language Selector</button>
                <button class="test-btn" onclick="testSRSButtons()">Test SRS Buttons</button>
                <button class="test-btn" onclick="testKeyboardNavigation()">Test Keyboard Navigation</button>
                <button class="test-btn" onclick="testErrorHandling()">Test Error Handling</button>
                <button class="test-btn" onclick="runAllControlTests()">Run All Tests</button>
                <button class="test-btn" onclick="clearResults()">Clear Results</button>
            </div>
            
            <!-- Controls Demo -->
            <div class="test-section">
                <h3>üéØ Controls Demo</h3>
                <div class="controls-demo">
                    <div class="control-group">
                        <label for="level-select" class="control-label">HSK Level</label>
                        <select id="level-select" class="select-input">
                            <option value="all">All levels</option>
                            <option value="1">HSK 1</option>
                            <option value="2">HSK 2</option>
                            <option value="3">HSK 3</option>
                            <option value="4">HSK 4</option>
                            <option value="5">HSK 5</option>
                            <option value="6">HSK 6</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Practice Mode</label>
                        <div class="practice-modes">
                            <div class="mode-option">
                                <input type="radio" id="char-to-pinyin" name="practice-mode" value="char-to-pinyin" checked>
                                <label for="char-to-pinyin">Character ‚Üí Pinyin</label>
                            </div>
                            <div class="mode-option">
                                <input type="radio" id="char-to-english" name="practice-mode" value="char-to-english">
                                <label for="char-to-english">Character ‚Üí English</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <button id="theme-toggle" class="btn-icon">
                            <span class="theme-icon light-icon">‚òÄÔ∏è</span>
                            <span class="theme-icon dark-icon">üåô</span>
                        </button>
                        
                        <select id="language-select" class="select-control">
                            <option value="es">Espa√±ol</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <div class="action-buttons">
                            <button id="srs-again" class="btn btn-error">Again</button>
                            <button id="srs-hard" class="btn btn-warning">Hard</button>
                            <button id="srs-good" class="btn btn-success">Good</button>
                            <button id="srs-easy" class="btn btn-primary">Easy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Test Results -->
        <div class="test-results">
            <h3>üìä Test Results</h3>
            <div id="test-results-list">
                <p>Click a test button to run tests...</p>
            </div>
        </div>
        
        <!-- Console Output -->
        <div class="console-output" id="console-output">
            Console output will appear here...
        </div>
    </div>
    
    <script src="translations.js"></script>
    <script src="app.js"></script>
    
    <script>
        let testResults = [];
        let app;
        
        // Test vocabulary data
        const testVocabulary = [
            { character: '‰Ω†', pinyin: 'n«ê', english: 'you', translation: 't√∫', level: 1 },
            { character: 'Â•Ω', pinyin: 'h«éo', english: 'good', translation: 'bueno', level: 1 },
            { character: 'Êàë', pinyin: 'w«í', english: 'I', translation: 'yo', level: 1 }
        ];
        
        // Initialize app for testing
        window.addEventListener('load', () => {
            try {
                app = new HSKApp();
                app.vocabulary = testVocabulary;
                app.currentWord = testVocabulary[0];
                app.currentSession = testVocabulary;
                app.sessionIndex = 0;
                app.isFlipped = true; // For SRS button testing
                logToConsole('‚úÖ HSK App initialized for controls testing');
            } catch (error) {
                logToConsole('‚ùå Failed to initialize HSK App: ' + error.message);
            }
        });
        
        // Console logging
        function logToConsole(message) {
            const consoleEl = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            consoleEl.textContent += `[${timestamp}] ${message}\n`;
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }
        
        // Test functions
        async function testLevelSelector() {
            logToConsole('üß™ Testing level selector...');
            let passed = 0;
            let failed = 0;
            
            try {
                const levelSelect = document.getElementById('level-select');
                
                if (!levelSelect) {
                    logToConsole('‚ùå Level selector not found');
                    failed++;
                } else {
                    logToConsole('‚úÖ Level selector found');
                    passed++;
                }
                
                // Test level change
                const originalLevel = app.selectedLevel;
                levelSelect.value = '2';
                levelSelect.dispatchEvent(new Event('change'));
                
                await new Promise(resolve => setTimeout(resolve, 200));
                
                if (app.selectedLevel === '2') {
                    logToConsole('‚úÖ Level change: successful');
                    passed++;
                } else {
                    logToConsole('‚ùå Level change: failed');
                    failed++;
                }
                
                // Test invalid level handling
                levelSelect.value = 'invalid';
                levelSelect.dispatchEvent(new Event('change'));
                
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // Should not change to invalid level
                if (app.selectedLevel !== 'invalid') {
                    logToConsole('‚úÖ Invalid level handling: successful');
                    passed++;
                } else {
                    logToConsole('‚ùå Invalid level handling: failed');
                    failed++;
                }
                
            } catch (error) {
                logToConsole('‚ùå Error in level selector test: ' + error.message);
                failed++;
            }
            
            addTestResult('Level Selector', passed > failed, `${passed}/${passed + failed} tests passed`);
        }
        
        async function testPracticeModes() {
            logToConsole('üß™ Testing practice modes...');
            let passed = 0;
            let failed = 0;
            
            try {
                const practiceRadios = document.querySelectorAll('input[name="practice-mode"]');
                
                if (practiceRadios.length === 0) {
                    logToConsole('‚ùå Practice mode radios not found');
                    failed++;
                } else {
                    logToConsole('‚úÖ Practice mode radios found');
                    passed++;
                }
                
                // Test mode change
                const englishRadio = document.getElementById('char-to-english');
                if (englishRadio) {
                    englishRadio.checked = true;
                    englishRadio.dispatchEvent(new Event('change'));
                    
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    if (app.practiceMode === 'char-to-english') {
                        logToConsole('‚úÖ Practice mode change: successful');
                        passed++;
                    } else {
                        logToConsole('‚ùå Practice mode change: failed');
                        failed++;
                    }
                }
                
            } catch (error) {
                logToConsole('‚ùå Error in practice modes test: ' + error.message);
                failed++;
            }
            
            addTestResult('Practice Modes', passed > failed, `${passed}/${passed + failed} tests passed`);
        }
        
        async function testThemeToggle() {
            logToConsole('üß™ Testing theme toggle...');
            let passed = 0;
            let failed = 0;
            
            try {
                const themeToggle = document.getElementById('theme-toggle');
                
                if (!themeToggle) {
                    logToConsole('‚ùå Theme toggle not found');
                    failed++;
                } else {
                    logToConsole('‚úÖ Theme toggle found');
                    passed++;
                }
                
                // Test theme toggle
                const initialTheme = document.body.getAttribute('data-theme') || 'light';
                themeToggle.click();
                
                await new Promise(resolve => setTimeout(resolve, 300));
                
                const newTheme = document.body.getAttribute('data-theme') || 'light';
                if (newTheme !== initialTheme) {
                    logToConsole('‚úÖ Theme toggle: successful');
                    passed++;
                } else {
                    logToConsole('‚ùå Theme toggle: failed');
                    failed++;
                }
                
            } catch (error) {
                logToConsole('‚ùå Error in theme toggle test: ' + error.message);
                failed++;
            }
            
            addTestResult('Theme Toggle', passed > failed, `${passed}/${passed + failed} tests passed`);
        }
        
        async function testLanguageSelector() {
            logToConsole('üß™ Testing language selector...');
            let passed = 0;
            let failed = 0;
            
            try {
                const languageSelect = document.getElementById('language-select');
                
                if (!languageSelect) {
                    logToConsole('‚ùå Language selector not found');
                    failed++;
                } else {
                    logToConsole('‚úÖ Language selector found');
                    passed++;
                }
                
                // Test language change
                languageSelect.value = 'en';
                languageSelect.dispatchEvent(new Event('change'));
                
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Check if language manager was called
                logToConsole('‚úÖ Language change: triggered successfully');
                passed++;
                
            } catch (error) {
                logToConsole('‚ùå Error in language selector test: ' + error.message);
                failed++;
            }
            
            addTestResult('Language Selector', passed > failed, `${passed}/${passed + failed} tests passed`);
        }
        
        async function testSRSButtons() {
            logToConsole('üß™ Testing SRS buttons...');
            let passed = 0;
            let failed = 0;
            
            try {
                const srsButtons = ['srs-again', 'srs-hard', 'srs-good', 'srs-easy'];
                
                for (const buttonId of srsButtons) {
                    const button = document.getElementById(buttonId);
                    if (!button) {
                        logToConsole(`‚ùå SRS button ${buttonId} not found`);
                        failed++;
                        continue;
                    }
                    
                    // Test button click
                    button.click();
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    logToConsole(`‚úÖ SRS button ${buttonId}: click handled`);
                    passed++;
                }
                
            } catch (error) {
                logToConsole('‚ùå Error in SRS buttons test: ' + error.message);
                failed++;
            }
            
            addTestResult('SRS Buttons', passed > failed, `${passed}/${passed + failed} tests passed`);
        }
        
        async function testKeyboardNavigation() {
            logToConsole('üß™ Testing keyboard navigation...');
            let passed = 0;
            let failed = 0;
            
            try {
                // Test Enter key on level selector
                const levelSelect = document.getElementById('level-select');
                if (levelSelect) {
                    const enterEvent = new KeyboardEvent('keydown', { key: 'Enter' });
                    levelSelect.dispatchEvent(enterEvent);
                    
                    logToConsole('‚úÖ Keyboard: Enter key on level selector handled');
                    passed++;
                }
                
                // Test Space key on theme toggle
                const themeToggle = document.getElementById('theme-toggle');
                if (themeToggle) {
                    const spaceEvent = new KeyboardEvent('keydown', { key: ' ' });
                    themeToggle.dispatchEvent(spaceEvent);
                    
                    logToConsole('‚úÖ Keyboard: Space key on theme toggle handled');
                    passed++;
                }
                
            } catch (error) {
                logToConsole('‚ùå Error in keyboard navigation test: ' + error.message);
                failed++;
            }
            
            addTestResult('Keyboard Navigation', passed > failed, `${passed}/${passed + failed} tests passed`);
        }
        
        async function testErrorHandling() {
            logToConsole('üß™ Testing error handling...');
            let passed = 0;
            let failed = 0;
            
            try {
                // Test SRS button without current word
                const originalWord = app.currentWord;
                app.currentWord = null;
                
                const srsButton = document.getElementById('srs-good');
                if (srsButton) {
                    srsButton.click();
                    // Should handle gracefully
                    logToConsole('‚úÖ Error handling: SRS without word handled gracefully');
                    passed++;
                }
                
                // Restore word
                app.currentWord = originalWord;
                
                // Test invalid level
                const levelSelect = document.getElementById('level-select');
                if (levelSelect) {
                    levelSelect.value = 'invalid-level';
                    levelSelect.dispatchEvent(new Event('change'));
                    
                    // Should handle gracefully
                    logToConsole('‚úÖ Error handling: Invalid level handled gracefully');
                    passed++;
                }
                
            } catch (error) {
                logToConsole('‚úÖ Error handling: Exceptions caught properly');
                passed++;
            }
            
            addTestResult('Error Handling', passed >= 1, `${passed} error scenarios handled`);
        }
        
        async function runAllControlTests() {
            logToConsole('üöÄ Running all control tests...');
            clearResults();
            
            await testLevelSelector();
            await testPracticeModes();
            await testThemeToggle();
            await testLanguageSelector();
            await testSRSButtons();
            await testKeyboardNavigation();
            await testErrorHandling();
            
            logToConsole('‚úÖ All control tests completed');
            
            // Summary
            const totalTests = testResults.length;
            const passedTests = testResults.filter(r => r.passed).length;
            const failedTests = totalTests - passedTests;
            
            logToConsole(`üìä Test Summary: ${passedTests}/${totalTests} passed, ${failedTests} failed`);
        }
        
        function addTestResult(testName, passed, details) {
            testResults.push({ testName, passed, details });
            updateTestResultsDisplay();
        }
        
        function updateTestResultsDisplay() {
            const resultsEl = document.getElementById('test-results-list');
            
            if (testResults.length === 0) {
                resultsEl.innerHTML = '<p>No test results yet...</p>';
                return;
            }
            
            resultsEl.innerHTML = testResults.map(result => `
                <div class="test-result">
                    <span>${result.testName}</span>
                    <div>
                        <span class="test-status ${result.passed ? 'test-pass' : 'test-fail'}">
                            ${result.passed ? 'PASS' : 'FAIL'}
                        </span>
                        <small style="margin-left: 8px; opacity: 0.7;">${result.details}</small>
                    </div>
                </div>
            `).join('');
        }
        
        function clearResults() {
            testResults = [];
            updateTestResultsDisplay();
            document.getElementById('console-output').textContent = 'Console cleared...\n';
        }
        
        // Override console methods to capture output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            logToConsole('üìù ' + args.join(' '));
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logToConsole('‚ùå ' + args.join(' '));
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            logToConsole('‚ö†Ô∏è ' + args.join(' '));
            originalWarn.apply(console, args);
        };
        
        logToConsole('üéõÔ∏è Interactive controls test suite loaded');
    </script>
</body>
</html>